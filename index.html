<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebaseチャット</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      flex-direction: row;
    }
    #sidebar {
      width: 250px;
      background-color: #f4f4f4;
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    #chat-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    #chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      border-bottom: 1px solid #ddd;
    }
    #message-form {
      display: flex;
      padding: 10px;
      border-top: 1px solid #ddd;
    }
    #message-input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
    }
    .button, #send-button, #create-group-button, #join-group-button, #save-name-button, #auth-button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      background: linear-gradient(45deg, #007bff, #0056b3);
      color: white;
      cursor: pointer;
      margin-bottom: 10px;
      transition: background 0.3s, box-shadow 0.3s;
      display: block;
    }
    .button:hover, #send-button:hover, #create-group-button:hover, #join-group-button:hover, #save-name-button:hover, #auth-button:hover {
      background: linear-gradient(45deg, #0056b3, #004080);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    #name-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #name-form {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    #name-input {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: calc(100% - 22px);
      margin-bottom: 10px;
    }
    #group-container {
      padding: 10px;
      border-top: 1px solid #ddd;
      text-align: left;
    }
    #group-form {
      display: flex;
      flex-direction: column;
    }
    #group-name-input, #group-password-input {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    .group-button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      background: linear-gradient(45deg, #ff8c00, #ff4500);
      color: white;
      cursor: pointer;
      margin-bottom: 10px;
      transition: background 0.3s, box-shadow 0.3s;
      display: block;
    }
    .group-button:hover {
      background: linear-gradient(45deg, #ff4500, #ff2400);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    #auth-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #auth-form {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    #auth-group-id-input, #auth-group-password-input {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: calc(100% - 22px);
      margin-bottom: 10px;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
  <div id="sidebar">
    <div id="group-container">
      <form id="group-form">
        <input type="text" id="group-name-input" placeholder="グループ名を入力してください">
        <input type="password" id="group-password-input" placeholder="パスワードを入力してください">
        <button type="submit" id="create-group-button">グループ作成</button>
      </form>
      <button id="join-group-button">グループに参加</button>
    </div>
    <div id="current-group">
      <p>現在のグループ: <span id="current-group-name">なし</span></p>
    </div>
    <div id="group-history">
      <p>参加済みのグループ:</p>
      <!-- 参加済みのグループのボタンがここに追加されます -->
    </div>
  </div>
  <div id="chat-section">
    <div id="chat-container"></div>
    <form id="message-form">
      <input type="text" id="message-input" placeholder="メッセージを入力してください">
      <button type="submit" id="send-button">送信</button>
    </form>
  </div>
  <div id="name-container">
    <form id="name-form">
      <input type="text" id="name-input" placeholder="名前を入力してください">
      <button type="button" id="save-name-button">保存</button>
    </form>
  </div>
  <div id="auth-container">
    <form id="auth-form">
      <input type="text" id="auth-group-id-input" placeholder="グループIDを入力してください">
      <input type="password" id="auth-group-password-input" placeholder="パスワードを入力してください">
      <button type="submit" id="auth-button">認証</button>
    </form>
  </div>
  <script>
    const firebaseConfig = {
      // Your Firebase configuration
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    document.addEventListener("DOMContentLoaded", function() {
      const nameContainer = document.getElementById("name-container");
      const saveNameButton = document.getElementById("save-name-button");
      const nameInput = document.getElementById("name-input");
      const authContainer = document.getElementById("auth-container");
      const authForm = document.getElementById("auth-form");
      const authGroupIdInput = document.getElementById("auth-group-id-input");
      const authGroupPasswordInput = document.getElementById("auth-group-password-input");
      const groupForm = document.getElementById("group-form");
      const groupNameInput = document.getElementById("group-name-input");
      const groupPasswordInput = document.getElementById("group-password-input");
      const joinGroupButton = document.getElementById("join-group-button");
      const chatContainer = document.getElementById("chat-container");
      const messageForm = document.getElementById("message-form");
      const messageInput = document.getElementById("message-input");
      const currentGroupName = document.getElementById("current-group-name");
      let currentUserName = "";
      let currentGroupId = "";
      let currentGroupRef = null;

      saveNameButton.addEventListener("click", function() {
        currentUserName = nameInput.value;
        if (currentUserName !== "") {
          nameContainer.style.display = "none";
        }
      });

      groupForm.addEventListener("submit", function(event) {
        event.preventDefault();
        const groupName = groupNameInput.value;
        const groupPassword = groupPasswordInput.value;
        if (groupName && groupPassword) {
          const newGroupRef = database.ref("groups").push();
          newGroupRef.set({
            name: groupName,
            password: groupPassword
          });
          joinGroup(newGroupRef.key);
        }
      });

      joinGroupButton.addEventListener("click", function() {
        authContainer.style.display = "flex";
      });

      authForm.addEventListener("submit", function(event) {
        event.preventDefault();
        const groupId = authGroupIdInput.value;
        const groupPassword = authGroupPasswordInput.value;
        database.ref("groups/" + groupId).once("value", function(snapshot) {
          const groupData = snapshot.val();
          if (groupData && groupData.password === groupPassword) {
            authContainer.style.display = "none";
            joinGroup(groupId);
          } else {
            alert("グループIDまたはパスワードが間違っています。");
          }
        });
      });

      function joinGroup(groupId) {
        currentGroupId = groupId;
        currentGroupRef = database.ref("groups/" + groupId + "/messages");
        currentGroupRef.on("child_added", function(snapshot) {
          const messageData = snapshot.val();
          displayMessage(messageData.name, messageData.message);
        });
        database.ref("groups/" + groupId).once("value", function(snapshot) {
          const groupData = snapshot.val();
          currentGroupName.textContent = groupData.name;
        });
      }

      messageForm.addEventListener("submit", function(event) {
        event.preventDefault();
        const message = messageInput.value;
        if (message !== "" && currentGroupId !== "") {
          if (message === "/c") {
            clearChatHistory();
          } else {
            currentGroupRef.push().set({
              name: currentUserName,
              message: message
            });
          }
          messageInput.value = "";
        }
      });

      function displayMessage(name, message) {
        const messageElement = document.createElement("p");
        messageElement.textContent = name + ": " + message;
        chatContainer.appendChild(messageElement);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      function clearChatHistory() {
        if (currentGroupId !== "") {
          currentGroupRef.remove()
            .then(() => {
              chatContainer.innerHTML = "";
            })
            .catch((error) => {
              console.error("Error removing chat history: ", error);
            });
        }
      }
    });
  </script>
</body>
</html>
